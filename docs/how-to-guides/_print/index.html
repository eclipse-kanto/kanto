<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://eclipse.dev/kanto/docs/how-to-guides/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/kanto/favicons/favicon.ico><link rel=apple-touch-icon href=/kanto/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/kanto/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/kanto/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/kanto/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/kanto/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/kanto/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/kanto/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/kanto/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/kanto/favicons/android-192x192.png sizes=192x192><title>How-to guides | Eclipse Kanto™ | IoT edge software stack</title>
<meta name=description content="Explore the functionalities of Eclipse Kanto.
"><meta property="og:title" content="How-to guides"><meta property="og:description" content="Explore the functionalities of Eclipse Kanto.
"><meta property="og:type" content="website"><meta property="og:url" content="https://eclipse.dev/kanto/docs/how-to-guides/"><meta itemprop=name content="How-to guides"><meta itemprop=description content="Explore the functionalities of Eclipse Kanto.
"><meta name=twitter:card content="summary"><meta name=twitter:title content="How-to guides"><meta name=twitter:description content="Explore the functionalities of Eclipse Kanto.
"><link rel=preload href=/kanto/scss/main.min.a18aba0e2d7976803148e96cc2d140e57525cec88f2ff9e586327efa4c1a646e.css as=style><link href=/kanto/scss/main.min.a18aba0e2d7976803148e96cc2d140e57525cec88f2ff9e586327efa4c1a646e.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/kanto/css/prism.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-lg navbar-dark navbar-color td-navbar"><div class=container-fluid role=navigation><a class=navbar-brand href=/kanto/><span class=navbar-logo><svg id="kanto_logo" data-name="Kanto Logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 50"><defs><style>.cls-kanto_logo{fill:#fff}</style></defs><title>Eclipse Kanto</title><g transform="translate(0.0,50.0) scale(0.025,-0.025)"><path class="cls-kanto_logo" d="M370 1754c-168-290-306-529-308-533-2-6 557-986 604-1059l14-22h619 619l255 442c327 569 357 622 357 635 0 6-137 246-305 534l-304 524-623 2-623 2-305-525zm780 352c0-2-72-129-161-281-88-152-159-279-157-281s33 14 68 35c255 151 9e2 521 908 521 9 0 182-293 182-308 0-4-219-133-487-287-267-154-485-284-485-290 1-8 930-553 966-568 7-2-140-275-170-316-2-2-222 123-490 278-268 154-490 279-492 276-2-2 66-125 152-274 86-148 156-272 156-275 0-4-80-6-178-6H783L530 768c-139 240-253 442-253 448s114 210 253 452l254 442h183c101 0 183-2 183-4z"/><path class="cls-kanto_logo" d="M2890 1240V520h110 110v236 235l29-3c26-3 50-31 193-233l163-230 128-3c70-1 127 0 127 3s-86 128-191 276c-189 268-191 271-172 292 10 12 96 106 191 208 94 103 172 190 172 193s-60 6-134 6h-135l-158-170c-130-140-163-170-185-170h-28v4e2 4e2H3e3h-110v-720z"/><path class="cls-kanto_logo" d="M5965 1738c-3-18-12-77-20-132-7-54-16-1e2-19-103s-40-15-83-27l-78-22v-64-65l82-3 81-3 4-292c5-323 11-360 71-433 51-61 92-74 245-74h133l-3 67-3 67-80 24c-144 43-145 45-145 381v260l118 3 117 3 3 88 3 87h-121-120v135 135h-90-89l-6-32z"/><path class="cls-kanto_logo" d="M4165 1510c-102-9-236-35-267-51-14-8-18-23-18-74v-65h37c21 0 121 5 224 11 276 16 309 1 309-137v-74h-193c-228 0-277-10-336-69-53-53-71-113-71-234 0-119 12-164 58-217 49-58 102-82 193-88 91-5 158 12 273 69 43 22 80 38 82 36 1-1 12-24 23-50l20-47h86 86l-3 393c-3 385-3 393-26 442-64 139-190 180-477 155zm285-635V770l-27-11c-102-41-176-61-233-66-59-5-69-3-93 18-22 19-29 35-34 79-8 81 10 137 50 155 27 13 170 29 3e2 34l37 1V875z"/><path class="cls-kanto_logo" d="M5225 1486c-33-12-86-39-117-59l-58-37-14 33c-7 19-17 43-20 55-7 20-14 22-92 22h-84v-490-490h105 105v360 359l43 25c99 58 244 83 304 53 61-32 63-47 63-441V520h111 110l-3 378c-4 367-4 379-27 435-30 75-73 124-136 153-70 33-204 33-290 0z"/><path class="cls-kanto_logo" d="M6820 15e2c-96-13-187-63-227-124-43-64-62-128-75-263-13-126-2-288 26-380 49-159 197-231 451-220 239 10 340 82 380 274 17 81 20 318 4 413-24 150-96 243-218 280-76 24-242 34-341 20zm287-206c52-39 66-99 67-279s-10-238-54-280c-33-31-82-45-165-45-135 0-193 40-215 146-17 81-8 346 13 394 33 75 70 90 214 87 96-2 116-5 140-23z"/></svg></span>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=main_navbar><ul class="navbar-nav me-4 mb-2 mb-lg-0 ps-4 pl-lg-2"><li class="nav-item me-4 mb-2 mb-lg-0"><a class="nav-link active" href=/kanto/><span class=active>Home</span></a></li><li class="nav-item me-4 mb-2 mb-lg-0"><a class=nav-link href=/kanto/about/><span>About</span></a></li><li class="nav-item me-4 mb-2 mb-lg-0"><a class="nav-link active" href=/kanto/docs/><span class=active>Documentation</span></a></li><li class="nav-item me-4 mb-2 mb-lg-0"><a class=nav-link href=/kanto/community/><span>Community</span></a></li></ul><div class=navbar-nav><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/kanto/offline-search-index.b2c3e231bd776d692d08a227624162da.json data-offline-search-base-href=/ data-offline-search-max-results=50></div></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/kanto/docs/how-to-guides/>Return to the regular view of this page</a>.</p></div><h1 class=title>How-to guides</h1><div class=lead>Explore the functionalities of Eclipse Kanto.</div><ul><li>1: <a href=#pg-3295c64fd45a7278dec1f9ac3fb381aa>Update software</a></li><li>2: <a href=#pg-ea8723f5a1c117f2bc76a16b024f0ff2>Upload files</a></li><li>3: <a href=#pg-170e578a7b1df9ad1c0c8ef0bb738ad1>Back up and restore files</a></li><li>4: <a href=#pg-9ebac16b59e8e67bb0ee2b0c90c399b0>Create and update the containers `Desired State`</a></li><li>5: <a href=#pg-6fde9501abfa40949911a42750ff0751>Monitor system metrics</a></li><li>6: <a href=#pg-ebe8e48efb87068b8a27ab00b3a217ba>Verify signed container images</a></li><li>7: <a href=#pg-1270c26a5987c83543f97ae3e9983a6f>Offline explore edge device</a></li><li>8: <a href=#pg-bea39a8d06b8d75ef9bc7804b3a54bf6>Build Yocto Image for Raspberry Pi</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-3295c64fd45a7278dec1f9ac3fb381aa>1 - Update software</h1><div class=lead>Install a Debian package on your edge device.</div><p>By following the steps below you will install a<a href=https://www.gnu.org/software/hello/ target=_blank><code>hello</code></a>
Debian package via a publicly available Eclipse Hono sandbox using Eclipse Kanto.
A couple of simple Eclipse Hono northbound business applications written in Python are provided to explore
the capabilities for remotely installing and monitoring.
On the edge side, a basic
<a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/install_hello.sh target=_blank><code>install_hello.sh</code></a>
script will be downloaded and executed.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that your edge device is capable to execute the steps in this guide, you need:</p><ul><li><p>Debian-based linux distribution and the <code>apt</code> command line tool</p></li><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto, follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_su.py target=_blank>software update application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a>
guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_su.py
</span></span></code></pre></div></li><li><p>Executing <code>hello</code> in the terminal will return that the command is not found</p></li></ul><h3 id=install-debian-package>Install Debian package</h3><p>To explore the software management, we will use two Python scripts to install and monitor the <code>hello</code> Debian package.
The location where the Python applications will run does not have to be your edge device as they communicate remotely
with Eclipse Hono only.</p><p>First, start the monitoring application that requires the configured Eclipse Hono tenant (<code>-t</code>) and will print all
received events triggered by the device:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_events.py -t demo
</span></span></code></pre></div><p>In another terminal, we are ready to spin up a <code>hello</code> Debian package at the edge via executing the second application
that requires the Eclipse Hono tenant (<code>-t</code>) and the device identifier (<code>-d</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_su.py -t demo -d demo:device
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>You can check out that the new package is installed on your edge device via executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hello
</span></span></code></pre></div><p>The command now displays: <code>Hello, world!</code></p><h3 id=clean-up>Clean up</h3><p>The installed <code>hello</code> Debian package can be removed via executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt remove hello
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ea8723f5a1c117f2bc76a16b024f0ff2>2 - Upload files</h1><div class=lead>Upload a log file from your edge device.</div><p>By following the steps below you will upload an example log file to your HTTP file server
via a publicly available Eclipse Hono sandbox using Eclipse Kanto.
A simple Eclipse Hono northbound business application written in Python is
provided to explore the capabilities for remotely uploading and monitoring.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that all steps in this guide can be executed, you need:</p><ul><li><p><a href=https://github.com/sebageek/servefile/ target=_blank><code>servefile</code></a> installed</p><p>This is a small Python HTTP server used in the example to serve the uploads.
It does not have to be running on your edge device but it has to be accessible from there.
You can install it by executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip3 install servefile
</span></span></code></pre></div></li><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto on your edge device,
follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_fu.py target=_blank>file upload application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a> guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_fu.py
</span></span></code></pre></div></li></ul><h3 id=upload-log-file>Upload log file</h3><p>By default, all files in <code>/var/tmp/file-upload/</code> directory can be uploaded.
For example, grab the suite connector log file and place it in the directory via executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /var/tmp/file-upload/ &amp;&amp; sudo cp /var/log/suite-connector/suite-connector.log /var/tmp/file-upload/
</span></span></code></pre></div><p>Choose a directory where the log file will be uploaded, open a new terminal there and run <code>servefile</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>servefile -u .
</span></span></code></pre></div><p>To explore the file upload, we will use a Python script to request and monitor the operation.
The location where the Python application will run does not have to be your edge device as it communicates remotely
with Eclipse Hono only.</p><p>Now we are ready to request the log file upload from the edge via executing the application
that requires the Eclipse Hono tenant (<code>-t</code>) and the device identifier (<code>-d</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_fu.py -t demo -d demo:device
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>You can check out that the log file is on your HTTP file server by listing the content of <code>servefile</code> working directory.</p><h3 id=clean-up>Clean up</h3><p>Stop <code>servefile</code> and clean up its working directory.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-170e578a7b1df9ad1c0c8ef0bb738ad1>3 - Back up and restore files</h1><div class=lead>Back up and restore a file from and to your edge device.</div><p>By following the steps below you will back up a simple text file to an HTTP file server
and then restore it back via a publicly available Eclipse Hono sandbox using Eclipse Kanto.
A simple Eclipse Hono northbound business application written in Python is
provided to explore the capabilities for remotely backing up and restoring files.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that all steps in this guide can be executed, you need:</p><ul><li><p><a href=https://github.com/sebageek/servefile/ target=_blank><code>servefile</code></a> installed</p><p>This is a small Python HTTP server used in the example to serve the uploads and downloads.
It does not have to be running on your edge device, but it has to be accessible from there.
You can install it by executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip3 install servefile
</span></span></code></pre></div></li><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto on your edge device,
follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_fb.py target=_blank>file backup and restore application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a> guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_fb.py
</span></span></code></pre></div></li></ul><h3 id=back-up>Back up</h3><p>By default, all directories in <code>/var/tmp/file-backup/</code> or the directory itself can be backed up.
For this example, create a file <code>data.txt</code> which will be later backed up:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo mkdir -p /var/tmp/file-backup &amp;&amp; sudo <span style=color:#0aa>echo</span> <span style=color:#a50>&#34;This is the first line in the file!&#34;</span> &gt;&gt; /var/tmp/file-backup/data.txt
</span></span></code></pre></div><p>You can verify that the file was successfully created by executing the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /var/tmp/file-backup/data.txt
</span></span></code></pre></div><p>This should produce <code>This is the first line in the file!</code> as an output.</p><p>Choose a directory where the text file will be uploaded, open a new terminal there and run <code>servefile</code>
with the flag <code>-u</code> to enable a file upload:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>servefile -u .
</span></span></code></pre></div><p>To explore the file backup, we will use a Python script to request and monitor the operation.
The location where the Python application will run does not have to be your edge device as it communicates remotely
with Eclipse Hono only.</p><p>Now we are ready to request the text file backup from the edge via executing the application that requires the command
to execute (<code>backup</code>), Eclipse Hono tenant (<code>-t</code>), the device identifier (<code>-d</code>) and the host where the backup will
be uploaded to:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_fb.py backup -t demo -d demo:device -h localhost
</span></span></code></pre></div><p>You can check out that the backup file <code>data.zip</code> is on your HTTP file server by
listing the content of the <code>servefile</code> working directory.</p><h3 id=restore>Restore</h3><p>To explore the restore capabilities you will first modify the <code>data.txt</code> file, and then you will restore it to
the version before the changes by using the backup, that was created earlier.</p><p>You can modify the <code>data.txt</code> file with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo <span style=color:#0aa>echo</span> <span style=color:#a50>&#34;This is the second line in the file!&#34;</span> &gt;&gt; /var/tmp/file-backup/data.txt
</span></span></code></pre></div><p>You can verify that the file was successfully updated by executing the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /var/tmp/file-backup/data.txt
</span></span></code></pre></div><p>This output should be:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>This is the first line in the file!
</span></span><span style=display:flex><span>This is the second line in the file!
</span></span></code></pre></div><p>Navigate to the terminal where <code>servefile</code> was started and terminate it.
Start it again with the flag <code>-l</code> to enable a file download:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>servefile -l .
</span></span></code></pre></div><p>To explore the file restore, we will use a Python script to request and monitor the operation.
The location where the Python application will run does not have to be your edge device as it communicates remotely
with Eclipse Hono only.</p><p>Now we are ready to request the text file restore from the edge via executing the application that requires the command
to execute (<code>restore</code>), Eclipse Hono tenant (<code>-t</code>), the device identifier (<code>-d</code>) and the host where the backup file
will be downloaded from:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_fb.py restore -t demo -d demo:device -h localhost
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>You can check out that the original file is restored by executing the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /var/tmp/file-backup/data.txt
</span></span></code></pre></div><p>This should produce <code>This is the first line in the file!</code> as an output.</p><h3 id=clean-up>Clean up</h3><p>Stop <code>servefile</code> and clean up its working directory.
Remove the <code>data.txt</code> file from the <code>/var/tmp/file-backup</code> directory.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9ebac16b59e8e67bb0ee2b0c90c399b0>4 - Create and update the containers `Desired State`</h1><div class=lead>Create and update containers via <code>Desired State</code> using the <code>update-manage</code></div><p>By following the steps below you will publish a simple <code>Desired State</code> specification via a publicly available Eclipse Hono sandbox and then the specification will be handled by the Eclipse Kanto Update Manager, which will trigger an OTA update on
the edge device.</p><p>A simple monitoring application will track the progress and the status of the update process.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that all steps in this guide can be executed, you need:</p><ul><li><p>Debian-based linux distribution and the <code>apt</code> command line tool</p></li><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto, follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_um.py target=_blank>update manager application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a>
guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_um.py
</span></span></code></pre></div></li><li><p>Enable the <code>containers update agent</code> service of the <code>Container Management</code> by adding the <code>"update_agent": {"enable": true}</code> property to the <code>container-management</code> service configuration (by default located at <code>/etc/container-management/config.json</code>)
and restart the service:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl restart container-management
</span></span></code></pre></div></li></ul><h3 id=publish-the-desired-state-specification>Publish the <code>Desired State</code> specification</h3><p>First, start the monitoring application that requires the configured Eclipse Hono tenant (<code>-t</code>) and an optional filter parameter (<code>-f</code>). It will print all
received feedback events triggered by the device:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_events.py -t demo -f demo/device/things/live/messages/feedback
</span></span></code></pre></div><p>The starting point of the OTA update process is to publish the example <code>Desired State</code> specification:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_um.py -t demo -d demo:device -o apply
</span></span></code></pre></div><p>The <code>Desired State</code> specification in this case consists of single domain section definition for the containers domain and a three container components - <code>influxdb</code>, <code>hello-world</code> and <code>alpine</code> image.</p><h3 id=apply-desired-state-specification>Apply <code>Desired State</code> specification</h3><p>The Update Manager receives the published <code>Desired State</code> to the local Mosquitto broker, splits the specification (in this case into single domain) and then
distributes the processed specification to the domain agents which initiates the actual update process logic on the domain agents side.</p><p>The update process is organized into multiple phases, which are triggered by sending specific <code>Desired State</code> commands (<code>DOWNLOAD/UPDATE/ACTIVATE</code>).</p><p>In the example scenario, the three images for the three container components will be pulled (if not available in the cache locally), created as containers during the <code>UPDATING</code> phase and
started in the <code>ACTIVATING</code> phase.</p><h3 id=monitor-ota-update-progress>Monitor OTA update progress</h3><p>During the OTA update, the progress can be tracked in the monitoring application fot the <code>Desired State</code> feedback messages, started in the prerequisite section above.</p><p>The Update Manager reports at a time interval of a second the status of the active update process. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#1e90ff;font-weight:700>&#34;activityId&#34;</span>:<span style=color:#a50>&#34;e5c858cc-2057-41b0-bd5f-83aee0aad22e&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#1e90ff;font-weight:700>&#34;timestamp&#34;</span>:<span style=color:#099>1693201088401</span>,
</span></span><span style=display:flex><span>   <span style=color:#1e90ff;font-weight:700>&#34;desiredStateFeedback&#34;</span>:{
</span></span><span style=display:flex><span>      <span style=color:#1e90ff;font-weight:700>&#34;status&#34;</span>:<span style=color:#a50>&#34;RUNNING&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#1e90ff;font-weight:700>&#34;actions&#34;</span>:[
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;component&#34;</span>:{
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;id&#34;</span>:<span style=color:#a50>&#34;containers:alpine&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;version&#34;</span>:<span style=color:#a50>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;status&#34;</span>:<span style=color:#a50>&#34;UPDATE_SUCCESS&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;message&#34;</span>:<span style=color:#a50>&#34;New container instance is started.&#34;</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;component&#34;</span>:{
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;id&#34;</span>:<span style=color:#a50>&#34;containers:hello-world&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;version&#34;</span>:<span style=color:#a50>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;status&#34;</span>:<span style=color:#a50>&#34;UPDATE_SUCCESS&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;message&#34;</span>:<span style=color:#a50>&#34;New container instance is started.&#34;</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;component&#34;</span>:{
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;id&#34;</span>:<span style=color:#a50>&#34;containers:influxdb&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#1e90ff;font-weight:700>&#34;version&#34;</span>:<span style=color:#a50>&#34;2.7.1&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;status&#34;</span>:<span style=color:#a50>&#34;UPDATING&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#1e90ff;font-weight:700>&#34;message&#34;</span>:<span style=color:#a50>&#34;New container created.&#34;</span>
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=list-containers>List containers</h3><p>After the update process is completed, list the installed containers by executing the command <code>kanto-cm list</code> to verify if the <code>Desired State</code> is applied correctly.</p><p>The output of the command should display the info about the three containers, described in the <code>Desired State</code> specification. The <code>influxdb</code> is expected to be in <code>RUNNING</code> state and
the other containers in status <code>EXITED</code>. For example :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ID                                    |Name         |Image                               |Status   |Finished At |Exit Code
</span></span><span style=display:flex><span>|-------------------------------------|-------------|------------------------------------|----------------------|---------
</span></span><span style=display:flex><span>7fe6b689-eb76-476d-a730-c2f422d6e8ea  |influxdb     |docker.io/library/influxdb:1.8.4    |Running  |            |0
</span></span><span style=display:flex><span>c36523d7-8d17-4255-ae0c-37f11003f658  |hello-world  |docker.io/library/hello-world:latest|Exited   |            |0
</span></span><span style=display:flex><span>9b99978b-2593-4736-bb52-7a07be4a7ed1  |alpine       |docker.io/library/alpine:latest     |Exited   |            |0
</span></span></code></pre></div><h3 id=update-desired-state-specification>Update <code>Desired State</code> specification</h3><p>To update the existing <code>Desired State</code> run the command below. The update changes affect two containers - <code>alpine</code> and <code>influxdb</code>. Being not present in the updated <code>Desired State</code> specification, the <code>alpine</code> container will be removed from the system. The <code>influxdb</code> will be updated to version 1.8.5. The last container - <code>hello-world</code> is not affected and any events will be not reported from the container update agent for this particular container.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_um.py -t demo -d demo:device -o update
</span></span></code></pre></div><h3 id=list-updated-containers>List updated containers</h3><p>After the update process of the existing <code>Desired State</code> is completed, list again the available containers to the verify the <code>Desired State</code> is updated correctly.</p><p>The output of the command should display the info about the two containers, described in the <code>Desired State</code> specification. The <code>influxdb</code> is expected to be updated with the version 1.8.5 and in <code>RUNNING</code> state and <code>hello-world</code> container to be status <code>EXITED</code> with version unchanged. The <code>alpine</code> container must be removed and not displayed.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ID                                    |Name         |Image                               |Status   |Finished At |Exit Code
</span></span><span style=display:flex><span>|-------------------------------------|-------------|------------------------------------|----------------------|---------
</span></span><span style=display:flex><span>7fe6b689-eb76-476d-a730-c2f422d6e8ea  |influxdb     |docker.io/library/influxdb:1.8.5    |Running  |            |0
</span></span><span style=display:flex><span>c36523d7-8d17-4255-ae0c-37f11003f658  |hello-world  |docker.io/library/hello-world:latest|Exited   |            |0
</span></span></code></pre></div><h3 id=remove-all-containers>Remove all containers</h3><p>To remove all containers, publish an empty <code>Desired State</code> specification (with empty <code>components</code> section):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_um.py -t demo -d demo:device -o clean
</span></span></code></pre></div><p>As a final step, execute the command <code>kanto-cm list</code> to verify that the containers are actually removed from the Kanto container management.
The expected output is <code>No found containers.</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6fde9501abfa40949911a42750ff0751>5 - Monitor system metrics</h1><div class=lead>Monitor system metrics from your edge device.</div><p>By following the steps below you will be able to monitor the system metrics from your edge device
via a publicly available Eclipse Hono sandbox using Eclipse Kanto. A simple Eclipse Hono
northbound business application written in Python is provided to explore the capabilities
for remotely monitoring the CPU and memory utilization.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that all steps in this guide can be executed, you need:</p><ul><li><p><a href=https://plotly.com/ target=_blank><code>Plotly</code></a> and
<a href=https://plotly.com/dash/ target=_blank><code>Dash</code></a> installed</p><p><a href=https://plotly.com/ target=_blank><code>Plotly</code></a> is an open-source plotting library and
<a href=https://plotly.com/dash/ target=_blank><code>Dash</code></a> is a framework for building data application in Python.
They are used in this example to run a simple HTTP server and visualize the incoming system metrics data
in real time, and they do not have to be running on your edge device.
You can install them by executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip3 install plotly dash
</span></span></code></pre></div></li><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto on your edge device,
follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_sm.py target=_blank>system metrics application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a> guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_sm.py
</span></span></code></pre></div></li></ul><h3 id=monitor-system-metrics>Monitor system metrics</h3><p>To explore the system metrics, we will use a Python script to request and monitor the
CPU and memory utilization. The location where the Python application will run does
not have to be your edge device as it communicates remotely with Eclipse Hono only.</p><p>Now we are ready to request the system metrics from the edge via executing the application
that requires the Eclipse Hono tenant (<code>-t</code>) and the device identifier (<code>-d</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_sm.py -t demo -d demo:device
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>You can check out that the CPU and memory utilization metrics are properly received and displayed
by checking out the application dashboard (by default - <a href=http://127.0.0.1:8050 target=_blank>http://127.0.0.1:8050</a>).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ebe8e48efb87068b8a27ab00b3a217ba>6 - Verify signed container images</h1><div class=lead>Verify that container image is signed when creating a container from it in Kanto Container Management.</div><p>By following the steps below, you will sign a container image and push it to a local registry using a<a href=https://github.com/notaryproject/notation target=_blank><code>notation</code></a>. Then a notation trust policy and the Kanto Container Management service will be configured in a way that running containers from the signed image via kanto-cm CLI will be successful, while running containers from unsigned images will fail.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that your edge device is capable to execute the steps in this guide, you need:</p><ul><li>If you don&rsquo;t have an installed and running Eclipse Kanto, follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></li><li>Installed <a href=https://notaryproject.dev/docs/user-guides/installation/cli/ target=_blank>Notation CLI</a></li><li>Installed and running <a href=https://www.docker.com/products/docker-desktop/ target=_blank>Docker</a></li></ul><h3 id=create-an-image-and-push-it-to-a-local-registry-using-docker-and-than-sign-it-with-notation>Create an image and push it to a local registry using docker and than sign it with notation</h3><p>Create and run a local container registry:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo kanto-cm create --ports 5000:5000 --e <span style=color:#a00>REGISTRY_STORAGE_DELETE_ENABLED</span>=<span style=color:#0aa>true</span> --name registry docker.io/library/registry:latest
</span></span><span style=display:flex><span>sudo kanto-cm start -n registry
</span></span></code></pre></div><p>Build a dummy hello world image and push it to the registry:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#a50>&lt;&lt;EOF | sudo docker build -t localhost:5000/dummy-hello:signed -
</span></span></span><span style=display:flex><span><span style=color:#a50>FROM busybox:latest
</span></span></span><span style=display:flex><span><span style=color:#a50>CMD [ &#34;echo&#34;, &#34;Hello World&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#a50>EOF</span>
</span></span><span style=display:flex><span>sudo docker push localhost:5000/dummy-hello:signed
</span></span></code></pre></div><p><div class="alert alert-light alert-docs-container" role=alert><div><span class=alert-docs-pic><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><defs><style>.cls-alert-tip{fill:#a19f20}</style></defs><title>Tip</title><path class="cls-alert-tip" d="M53.905 126.999l5.631 5.684-14.292 14.159-5.63-5.684L53.904 127zm98.481-86.3-5.63-5.683-14.414 14.28 5.63 5.683 14.414-14.28zm-19.922 91.984 14.292 14.159 5.63-5.684L138.096 127l-5.631 5.684zM59.658 49.295 45.244 35.016l-5.63 5.684 14.414 14.279 5.63-5.684zM72 160h48v-8H72v8zm4 16h40v-8H76v8zm53.906-118.291C120.844 48.868 108.803 44 96 44s-24.844 4.869-33.906 13.709C53.005 66.575 48 78.37 48 90.922c0 12.553 5.005 24.348 14.094 33.215 1.395 1.36 2.74 2.479 4.042 3.56.448.373.903.751 1.367 1.146.257.217.553.456.877.716 1.354 1.086 3.62 2.905 3.62 4.44v10h8v-10c0-5.373-4.302-8.825-6.613-10.68-.26-.209-.5-.4-.706-.575-.487-.413-.963-.809-1.431-1.199-1.236-1.026-2.402-1.996-3.57-3.135C60.148 111.063 56 101.301 56 90.923s4.148-20.14 11.68-27.488C75.24 56.061 85.298 52 96 52c10.704.0 20.76 4.061 28.32 11.435 7.532 7.348 11.68 17.11 11.68 27.488s-4.148 20.14-11.68 27.488c-1.168 1.139-2.334 2.109-3.57 3.135-.468.39-.944.786-1.431 1.2-.206.174-.445.365-.706.574-2.31 1.855-6.613 5.307-6.613 10.68v10h8v-10c0-1.535 2.266-3.354 3.62-4.44.324-.26.62-.499.876-.716.465-.395.92-.773 1.368-1.145 1.302-1.082 2.647-2.2 4.042-3.561C138.995 115.27 144 103.476 144 90.923c0-12.552-5.005-24.348-14.094-33.215zM152 88v8h19.91v-8H152zM40 88H20.09v8H40v-8zm60-72h-8v20h8V16z"/></svg></span></div>When signing and verifying container images it is recommended to use the image digest instead of a tag as the digest is immutable.</div>Get the image digest and assign it to an environment variable to be used the next steps of the guide:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>export</span> <span style=color:#a00>IMAGE</span>=<span style=color:#00a>$(</span>sudo docker inspect --format=<span style=color:#a50>&#39;{{index .RepoDigests 0}}&#39;</span> localhost:5000/dummy-hello:signed<span style=color:#00a>)</span>
</span></span><span style=display:flex><span><span style=color:#0aa>echo</span> <span style=color:#a00>$IMAGE</span>
</span></span></code></pre></div><p>Generate a key-pair with notation and add it as the default signing key:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>notation cert generate-test --default <span style=color:#a50>&#34;kanto&#34;</span>
</span></span></code></pre></div><p>Sign the image and store the signature in the registry:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>notation sign <span style=color:#a00>$IMAGE</span>
</span></span></code></pre></div><h3 id=configure-notation-truspolicy-and-container-management-verifier>Configure notation truspolicy and container management verifier</h3><p>Get the notation config directory and assign it to an environment variable to be used in the next steps of the guide:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>export</span> <span style=color:#a00>NOTATION_CONFIG</span>=<span style=color:#a50>${</span><span style=color:#a00>XDG_CONFIG_HOME</span><span style=color:#00a>:-</span><span style=color:#a00>$HOME</span>/.config<span style=color:#a50>}</span>/notation
</span></span><span style=display:flex><span><span style=color:#0aa>echo</span> <span style=color:#a00>$NOTATION_CONFIG</span>
</span></span></code></pre></div><p>Create a simple <a href=https://github.com/notaryproject/specifications/blob/main/specs/trust-store-trust-policy.md#trust-policy target=_blank>notation trustpolicy</a> as a <code>trustpolicy.json</code> file in the notation config directory:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#a50>&lt;&lt;EOF | tee $NOTATION_CONFIG/trustpolicy.json
</span></span></span><span style=display:flex><span><span style=color:#a50>{
</span></span></span><span style=display:flex><span><span style=color:#a50>  &#34;version&#34;: &#34;1.0&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a50>  &#34;trustPolicies&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#a50>    {
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;name&#34;: &#34;kanto-images&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;registryScopes&#34;: [ &#34;*&#34; ],
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;signatureVerification&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#a50>        &#34;level&#34; : &#34;strict&#34;
</span></span></span><span style=display:flex><span><span style=color:#a50>      },
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;trustStores&#34;: [ &#34;ca:kanto&#34; ],
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;trustedIdentities&#34;: [ &#34;*&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#a50>    }
</span></span></span><span style=display:flex><span><span style=color:#a50>  ]
</span></span></span><span style=display:flex><span><span style=color:#a50>}
</span></span></span><span style=display:flex><span><span style=color:#a50>EOF</span>
</span></span></code></pre></div><p>Create a backup of the initial Kanto Container Management configuration that is found in <code>/etc/container-management/config.json</code>(the backup will be restored at the end of the guide):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo cp /etc/container-management/config.json /etc/container-management/config-backup.json
</span></span></code></pre></div><p>Configure the use of notation verifier, set its config directory, mark the local registry as an insecure one, and set the image expiry time to zero seconds, so the local cache of the images used in the how-to will be deleted upon container removal:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#a50>&lt;&lt;EOF | sudo tee /etc/container-management/config.json
</span></span></span><span style=display:flex><span><span style=color:#a50>{
</span></span></span><span style=display:flex><span><span style=color:#a50>  &#34;log&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#a50>    &#34;log_file&#34;: &#34;/var/log/container-management/container-management.log&#34;
</span></span></span><span style=display:flex><span><span style=color:#a50>  },
</span></span></span><span style=display:flex><span><span style=color:#a50>  &#34;containers&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#a50>    &#34;image_verifier_type&#34;: &#34;notation&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a50>    &#34;image_verifier_config&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#a50>      &#34;configDir&#34;: &#34;$NOTATION_CONFIG&#34;
</span></span></span><span style=display:flex><span><span style=color:#a50>    },
</span></span></span><span style=display:flex><span><span style=color:#a50>    &#34;insecure_registries&#34;: [ &#34;localhost:5000&#34; ],
</span></span></span><span style=display:flex><span><span style=color:#a50>    &#34;image_expiry&#34;: &#34;0s&#34;
</span></span></span><span style=display:flex><span><span style=color:#a50>  }
</span></span></span><span style=display:flex><span><span style=color:#a50>}
</span></span></span><span style=display:flex><span><span style=color:#a50>EOF</span>
</span></span></code></pre></div><p>Restart the Container Management service for the changes to take effect:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl restart container-management.service
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>Create and run a container from the signed image. The container prints <code>Hello world</code> to the console:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo kanto-cm create --name dummy-hello --rp no --t <span style=color:#a00>$IMAGE</span>
</span></span><span style=display:flex><span>sudo kanto-cm start --name dummy-hello --a
</span></span></code></pre></div><p>Make sure that a docker hub hello-world image is not cached locally, by removing any containers with this image, and verify that creating containers from it fails, as the image is not signed, and the signature verification fails:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo kanto-cm remove -f <span style=color:#00a>$(</span>sudo kanto-cm list --quiet --filter <span style=color:#a00>image</span>=docker.io/library/hello-world:latest<span style=color:#00a>)</span>
</span></span><span style=display:flex><span>sudo kanto-cm create --name dockerhub-hello --rp no --t docker.io/library/hello-world:latest
</span></span></code></pre></div><h3 id=clean-up>Clean up</h3><p>Remove the created containers from the Kanto Container Management:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo kanto-cm remove -n dummy-hello
</span></span><span style=display:flex><span>sudo kanto-cm remove -n registry -f
</span></span></code></pre></div><p>Restore the initial Kanto Container Management configuration and restart the service:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo mv -f /etc/container-management/config-backup.json /etc/container-management/config.json
</span></span><span style=display:flex><span>sudo systemctl restart container-management.service
</span></span></code></pre></div><p>Remove the localy cached images from Docker:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo docker image rm localhost:5000/dummy-hello:signed registry:latest
</span></span></code></pre></div><p>Reset the notation configuration by removing the directory:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rm -r <span style=color:#a00>$NOTATION_CONFIG</span>
</span></span></code></pre></div><p>Unset exported environment variables:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>unset</span> IMAGE NOTATION_CONFIG
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1270c26a5987c83543f97ae3e9983a6f>7 - Offline explore edge device</h1><div class=lead>Offline receive the structure of your edge device.</div><p>By following the steps below, you will get the structure of the edge digital twins with all its features and properties using Eclipse Kanto.
A simple Eclipse Hono northbound business application written in Python is provided to display the things&rsquo; and their features&rsquo; structure.</p><h3 id=before-you-begin>Before you begin</h3><p>To ensure that your edge device is capable to execute the steps in this guide, you need:</p><ul><li><p>If you don&rsquo;t have an installed and running Eclipse Kanto on your edge device,
follow <a href=/kanto/docs/getting-started/install/ target=_blank>Install Eclipse Kanto</a></p></li><li><p>If you don&rsquo;t have a connected Eclipse Kanto to Eclipse Hono sandbox,
follow <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a></p></li><li><p>Stop <code>suite-connector.service</code>. The local digital twins service is a replacement for the suite connector service, that is why either one of the services must be running.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl stop suite-connector.service
</span></span></code></pre></div></li><li><p>The <a href=https://github.com/eclipse-kanto/kanto/blob/main/quickstart/hono_commands_ldt.py target=_blank>offline explore application</a></p><p>Navigate to the <code>quickstart</code> folder where the resources from the <a href=/kanto/docs/getting-started/hono/ target=_blank>Explore via Eclipse Hono</a> guide are located and execute the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/eclipse-kanto/kanto/raw/main/quickstart/hono_commands_ldt.py
</span></span></code></pre></div></li></ul><h3 id=configure-local-digital-twins>Configure Local digital twins</h3><p>Open file <code>/etc/suite-connector/config.json</code>, copy <code>tenantId</code>, <code>deviceId</code>, <code>authId</code> and <code>password</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:red;background-color:#faa>...</span>
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;tenantId&#34;</span>: <span style=color:#a50>&#34;demo&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;deviceId&#34;</span>: <span style=color:#a50>&#34;demo:device&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;authId&#34;</span>: <span style=color:#a50>&#34;demo_device&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;password&#34;</span>: <span style=color:#a50>&#34;secret&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:red;background-color:#faa>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The local digital twins service uses the <code>/etc/local-digital-twins/config.json</code> to acquire all the remote communication, identification and
authentication data to establish the remote connection. Update the configuration as shown below and
replace <code>tenantId</code>, <code>deviceId</code>, <code>authId</code> and <code>password</code> with the settings that you copied in the previous step.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;logFile&#34;</span>: <span style=color:#a50>&#34;/var/log/local-digital-twins/local-digital-twins.log&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;caCert&#34;</span>: <span style=color:#a50>&#34;/etc/local-digital-twins/iothub.crt&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;thingsDb&#34;</span>: <span style=color:#a50>&#34;/var/lib/local-digital-twins/thing.db&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;tenantId&#34;</span>: <span style=color:#a50>&#34;demo&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;deviceId&#34;</span>: <span style=color:#a50>&#34;demo:device&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;authId&#34;</span>: <span style=color:#a50>&#34;demo_device&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#1e90ff;font-weight:700>&#34;password&#34;</span>: <span style=color:#a50>&#34;secret&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><p>Save the configuration and start the local digital twins service using the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl start local-digital-twins.service
</span></span></code></pre></div><h3 id=receive-the-structure-of-the-edge-device>Receive the structure of the edge device</h3><p>Now we are ready to request the structure of the edge digital twins via executing the offline explore application that requires the local digital twins tenant (<code>-t</code>) and the device identifier (<code>-d</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 hono_commands_ldt.py -t demo -d demo:device
</span></span></code></pre></div><h3 id=verify>Verify</h3><p>On the shell there will be output of the structure of the edge digital twins with all its features and properties. Things with the following identifiers will be presented:</p><ul><li>demo:device</li><li>demo:device:edge:containers</li></ul><h3 id=clean-up>Clean up</h3><p>Stop the local digital twins service and start suite connector service by executing:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl stop local-digital-twins.service &amp;&amp; <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>sudo systemctl restart suite-connector.service
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-bea39a8d06b8d75ef9bc7804b3a54bf6>8 - Build Yocto Image for Raspberry Pi</h1><div class=lead>This page provides all the instructions needed to build yocto image for raspberry pi with kanto recipes</div><p>Building a Yocto Image for a Raspberry Pi involves several steps, including setting up the environment, download the necessary layers, configuring the build and compiling the image.</p><h3 id=before-you-begin>Before you begin</h3><ul><li>Install the required packages required for the build on a Ubuntu/Debian system<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt install -y gawk wget git-core diffstat unzip texinfo gcc-multilib <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>build-essential chrpath socat cpio python3 python3-pip python3-pexpect <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>xz-utils debianutils iputils-ping libsdl1.2-dev xterm zstd liblz4-tool <span style=color:#a50>\
</span></span></span></code></pre></div></li></ul><h3 id=clone-the-yoctopoky-repository>Clone the Yocto/Poky Repository</h3><ul><li><p>Verify the Yocto Version of Kanto availabe in meta-kanto layer, <a href=/kanto/docs/getting-started/hono/ target=_blank><a href=https://github.com/eclipse-kanto/meta-kanto><a href=https://github.com/eclipse-kanto/meta-kanto>https://github.com/eclipse-kanto/meta-kanto</a></a></a>, this example provides information for kirkstone branch.</p></li><li><p>Create a Source folder</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir sources
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> sources
</span></span></code></pre></div></li><li><p>If it is kirkstone branch then, clone poky for kirkstone version in source directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/yoctoproject/poky.git
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> poky
</span></span><span style=display:flex><span>git checkout kirkstone
</span></span></code></pre></div><p>Note : Change branch based on meta-kanto layer.</p></li></ul><h3 id=add-meta-layers-to-the-source-directory>Add Meta Layers to the source directory</h3><ul><li><p>Based on the yocto version, clone the meta layers in the source directory
<code>meta-raspberrypi</code>
<code>meta-openembedded</code>
<code>meta-virtualization</code>
<code>meta-lts-mixins</code></p></li><li><p>Clone meta-raspberry pi layer to sources directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ..
</span></span><span style=display:flex><span>git clone git://git.yoctoproject.org/meta-raspberrypi
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> meta-raspberrypi
</span></span><span style=display:flex><span>git checkout kirkstone
</span></span></code></pre></div></li><li><p>Clone meta-openembedded layer to sources directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ..
</span></span><span style=display:flex><span>git clone https://github.com/openembedded/meta-openembedded.git
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> meta-openembedded
</span></span><span style=display:flex><span>git checkout kirkstone
</span></span></code></pre></div></li><li><p>Clone meta-virtualization layer to sources directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ..
</span></span><span style=display:flex><span>git clone https://git.yoctoproject.org/git/meta-virtualization
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> meta-virtualization
</span></span><span style=display:flex><span>git checkout kirkstone
</span></span></code></pre></div></li><li><p>Clone meta-lts-mixins layers to source directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ..
</span></span><span style=display:flex><span>git clone https://git.yoctoproject.org/git/meta-lts-mixins
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> meta-lts-mixins
</span></span><span style=display:flex><span>git checkout kirkstone/go
</span></span></code></pre></div><p>Note : The above layer is required to get the updated go version to be added in the yocto build, since kanto requires go version 1.19 and above.</p></li></ul><h3 id=add-meta-kanto-layer-to-the-sources-directory>Add meta-kanto layer to the sources directory</h3><ul><li><p>Clone meta-kanto layer to the sources directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ..
</span></span><span style=display:flex><span>git clone https://github.com/eclipse-kanto/meta-kanto.git
</span></span><span style=display:flex><span><span style=color:#0aa>cd</span> meta-kanto
</span></span><span style=display:flex><span>git checkout kirkstone
</span></span></code></pre></div><p>Note : Make sure all the layers cloned are of same yocto version ( kirkstone in this case)</p></li></ul><h3 id=create-build-directory>Create Build Directory</h3><ul><li><p>After cloning all the required meta layers, move out of source directory to create build directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0aa>cd</span> ../..
</span></span><span style=display:flex><span><span style=color:#0aa>source</span> sources/poky/oe-init-build-env
</span></span></code></pre></div></li><li><p>Run the below command to view the layers present in <code>bblayers.conf</code> file</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bitbake-layers show-layers
</span></span></code></pre></div><p>Note : Resolve any dependendencies if occured while running bitbake command.</p></li></ul><h3 id=configure-bblayerconf-file>Configure bblayer.conf file</h3><ul><li><p>By Default in the bblayer.conf file some of the layers will be added</p></li><li><p>Add all the layers to the bblayers.conf file with below command</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bitbake-layers add-layer /home/path/to/meta/layer/directory
</span></span></code></pre></div><p>The following layers should be added in the bblayer.conf file</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:red;background-color:#faa>meta-raspberrypi</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-openembedded</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-virtualization</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-lts-mixins</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-openembedded/meta-oe</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-openembedded/meta-python</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-opemembedded/meta-networking</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-openembedded/meta-filesystems</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>meta-kanto</span>
</span></span></code></pre></div></li><li><p>Example to add layers to bblayers.conf file</p><p>while adding layers bitbake might have dependencies, add the dependent layers first.
Example,</p><p>To add meta-kanto layer to bblayer.conf file which is kept at <code>/home/yocto/sources/meta-kanto</code></p><p><code>bitbake-layers add-layers /home/yocto/sources/meta-kanto</code></p></li><li><p>After adding all the required layers in bblayer.conf file, verify again by running the below command</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bitbake-layers show-layers
</span></span></code></pre></div></li></ul><h3 id=configure-localconf-file>Configure local.conf file</h3><ul><li><p>Open local.conf file which is placed at the below location in build directory</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vi conf/local.conf
</span></span></code></pre></div></li><li><p>Change the machine variable in local.conf file to raspberry pi machine</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:red;background-color:#faa>MACHINE</span> <span style=color:red;background-color:#faa>??=</span> <span style=color:#a50>&#34;raspberrypi4&#34;</span> 
</span></span></code></pre></div><p>Note: Check the sources/meta-raspberrypi/conf/machine for the availabe machines for raspberry pi.</p></li><li><p>Add required variables in local.conf file as shown and provided in the link below,</p><a href=/kanto/docs/getting-started/hono/ target=_blank><a href=https://github.com/eclipse-kanto/meta-kanto><a href=https://github.com/eclipse-kanto/meta-kanto>https://github.com/eclipse-kanto/meta-kanto</a></a></a><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>Add</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>required</span> <span style=color:red;background-color:#faa>DISTRO_FEATURES</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>DISTRO_FEATURES:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; virtualization systemd&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>Configure</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>kernel</span> <span style=color:red;background-color:#faa>modules</span> <span style=color:red;background-color:#faa>required</span> <span style=color:red;background-color:#faa>to</span> <span style=color:red;background-color:#faa>be</span> <span style=color:red;background-color:#faa>included</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS</span> <span style=color:red;background-color:#faa>+=</span> <span style=color:#a50>&#34;kernel-modules&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>System</span> <span style=color:red;background-color:#faa>initialization</span> <span style=color:red;background-color:#faa>manager</span> <span style=color:red;background-color:#faa>setup</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>VIRTUAL-RUNTIME_init_manager</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34;systemd&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>DISTRO_FEATURES_BACKFILL_CONSIDERED</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34;sysvinit&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>VIRTUAL-RUNTIME_initscripts</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34;systemd-compat-units&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>Add</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>Eclipse</span> <span style=color:red;background-color:#faa>Kanto</span> <span style=color:red;background-color:#faa>components</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; mosquitto&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; suite-connector&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; aws-connector&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; azure-connector&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; software-updates&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; file-upload&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; file-backup&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; update-manager&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; container-management&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>IMAGE_INSTALL:append</span> <span style=color:red;background-color:#faa>=</span> <span style=color:#a50>&#34; local-digital-twins&#34;</span>
</span></span></code></pre></div></li><li><p>Run bitbake `target-name&rsquo; availabe as shown below,</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:red;background-color:#faa>Common</span> <span style=color:red;background-color:#faa>targets</span> <span style=color:red;background-color:#faa>are:</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>core-image-minimal</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>core-image-full-cmdline</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>core-image-sato</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>core-image-weston</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>meta-toolchain</span>
</span></span><span style=display:flex><span>  <span style=color:red;background-color:#faa>meta-ide-support</span>
</span></span></code></pre></div><p>Note : If any build issues comes up, resolve the issue and run the bitbake `target-name&rsquo; command again for the build.</p></li></ul><h3 id=final-build-image-repository-location>Final Build Image Repository Location</h3><ul><li><p>After the successful build, the image will be availabe at the below location.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:red;background-color:#faa>build/tmp/deploy/images/`machine_name`/</span>
</span></span></code></pre></div></li></ul><h3 id=run--test-the-image-with-qemu-quick-emulator>Run & Test the image with QEMU (Quick Emulator)</h3><ul><li><p>If RaspberryPi device is not availabe, the image can be run and tested on QEMU. Make the below changes to run on QEMU.</p><p>In `build/conf/local.conf&rsquo; file</p></li><li><p>Change the machine variable name to relevant qemu arch as shown below by changing the <code>MACHINE</code> varilabe from raspberrypi4 to &lsquo;qemux86_64`</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>You</span> <span style=color:red;background-color:#faa>need</span> <span style=color:red;background-color:#faa>to</span> <span style=color:red;background-color:#faa>select</span> <span style=color:red;background-color:#faa>a</span> <span style=color:red;background-color:#faa>specific</span> <span style=color:red;background-color:#faa>machine</span> <span style=color:red;background-color:#faa>to</span> <span style=color:red;background-color:#faa>target</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>build</span> <span style=color:red;background-color:#faa>with.</span> <span style=color:red;background-color:#faa>There</span> <span style=color:red;background-color:#faa>are</span> <span style=color:red;background-color:#faa>a</span> <span style=color:red;background-color:#faa>selection</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>of</span> <span style=color:red;background-color:#faa>emulated</span> <span style=color:red;background-color:#faa>machines</span> <span style=color:red;background-color:#faa>available</span> <span style=color:red;background-color:#faa>which</span> <span style=color:red;background-color:#faa>can</span> <span style=color:red;background-color:#faa>boot</span> <span style=color:red;background-color:#faa>and</span> <span style=color:red;background-color:#faa>run</span> <span style=color:red;background-color:#faa>in</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>QEMU</span> <span style=color:red;background-color:#faa>emulator:</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#MACHINE</span> <span style=color:red;background-color:#faa>?=</span> <span style=color:#a50>&#34;qemuarm&#34;</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#MACHINE</span> <span style=color:red;background-color:#faa>?=</span> <span style=color:#a50>&#34;qemuarm64&#34;</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#MACHINE</span> <span style=color:red;background-color:#faa>?=</span> <span style=color:#a50>&#34;qemux86&#34;</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#MACHINE</span> <span style=color:red;background-color:#faa>?=</span> <span style=color:#a50>&#34;qemux86-64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>#</span> <span style=color:red;background-color:#faa>This</span> <span style=color:red;background-color:#faa>sets</span> <span style=color:red;background-color:#faa>the</span> <span style=color:red;background-color:#faa>default</span> <span style=color:red;background-color:#faa>machine</span> <span style=color:red;background-color:#faa>to</span> <span style=color:red;background-color:#faa>be</span> <span style=color:red;background-color:#faa>qemux</span><span style=color:#099>86-64</span> <span style=color:red;background-color:#faa>if</span> <span style=color:red;background-color:#faa>no</span> <span style=color:red;background-color:#faa>other</span> <span style=color:red;background-color:#faa>machine</span> <span style=color:red;background-color:#faa>is</span> <span style=color:red;background-color:#faa>selected:</span>
</span></span><span style=display:flex><span><span style=color:red;background-color:#faa>MACHINE</span> <span style=color:red;background-color:#faa>??=</span> <span style=color:#a50>&#34;qemuarm64&#34;</span>
</span></span></code></pre></div></li><li><p>Run bitbake <code>target-name</code> command by sourcing the <code>oe-init-build-env</code> script</p></li><li><p>In the same build directory run the below command to run qemu</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> runqemu qemuarm64
</span></span></code></pre></div><p><img src=/kanto/images/docs/how-to-guides/runqemu_qemuarm64.png alt=how-to-guides></p><p><img src=/kanto/images/docs/how-to-guides/login_page.png alt=how-to-guides></p></li><li><p>The above command will open a window which boots as &ldquo;YOCTO PROJECT&rdquo; and it enters to command line window. Enter login as `root&rsquo;, and check for kanto components with the below commands.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl status <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>suite-connector.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>container-management.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>software-update.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>file-upload.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>file-backup.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>system-metrics.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>kanto-update-manager.service
</span></span></code></pre></div><p>All listed services must be in an active running state.</p><p><img src=/kanto/images/docs/how-to-guides/verify_kanto_components.png alt=how-to-guides></p></li></ul><h3 id=flash-the-image-on-raspberry-pi>Flash the image on Raspberry Pi</h3><ul><li><p>The build image will be availabe at <code>build/tmp/deploy/images/raspberrypi4/</code></p></li><li><p>Identify the SD Card Device with the below command to find the device name of your SD card</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>lsblk
</span></span></code></pre></div></li><li><p>Flash the image to sd card</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo dd <span style=color:#00a>if</span>=/path/to/image.wic <span style=color:#a00>of</span>=/dev/sdX <span style=color:#a00>bs</span>=4M <span style=color:#a00>status</span>=progress
</span></span></code></pre></div></li><li><p>Boot the Raspberry Pi,</p><p>Insert the SD card into your Raspberry Pi and power it on. The Pi should boot from the Yocto image.Login to your device and run the below command to verify the kanto components.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl status <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>suite-connector.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>container-management.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>software-update.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>file-upload.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>file-backup.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>system-metrics.service <span style=color:#a50>\
</span></span></span><span style=display:flex><span><span style=color:#a50></span>kanto-update-manager.service
</span></span></code></pre></div></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Eclipse Kanto project" aria-label="Eclipse Kanto project"><a class=text-white target=_blank rel=noopener href=https://projects.eclipse.org/projects/iot.kanto aria-label="Eclipse Kanto project"><i class="fas fa-external-link-alt"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/eclipse-kanto aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=YouTube aria-label=YouTube><a class=text-white target=_blank rel=noopener href="https://www.youtube.com/watch?v=bMN_ZiUS3Bc" aria-label=YouTube><i class="fab fa-youtube"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=Newsletter aria-label=Newsletter><a class=text-white target=_blank rel=noopener href=https://newsroom.eclipse.org/eclipse-newsletter/2022/february/five-ways-eclipse-kanto-accelerates-iot-edge-development aria-label=Newsletter><i class="fas fa-book-open"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/eclipse-kanto aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=Releases aria-label=Releases><a class=text-white target=_blank rel=noopener href=https://github.com/eclipse-kanto/kanto/releases aria-label=Releases><i class="fas fa-rocket"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Task board" aria-label="Task board"><a class=text-white target=_blank rel=noopener href=https://github.com/orgs/eclipse-kanto/projects/1 aria-label="Task board"><i class="fas fa-clipboard-list"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://accounts.eclipse.org/mailing-list/kanto-dev aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 The Eclipse Kanto™ Project. All Rights Reserved.</small></div></div><div class=row><div class="col-12 text-center mb-2"><a href=https://eclipse.org/projects/what-is-incubation.php><img class=eclipse-incubation-logo src=https://eclipse.dev/kanto//images/logos/eclipse/eclipse_incubation_horizontal.svg alt=eclipse-incubation-logo>
</a><a href=https://iot.eclipse.org/><img class=eclipse-iot-logo src="https://eclipse.dev/kanto//images/logos/eclipse/new_iot_logo_clr -white.svg" alt=eclipse-iot></a></div></div><div class=row><div class="col-12 text-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org>Eclipse Foundation</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org/legal/privacy.php>Privacy Policy</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org/legal/termsofuse.php>Terms of Use</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org/legal/copyright.php>Copyright Agent</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org/legal/>Legal</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://github.com/eclipse-kanto/kanto/raw/main/LICENSE>License</a></small></li><li class="list-inline-item mx-2"><small class=ms-1><a class=text-footer-menu target=_blank rel=noopener href=https://eclipse.org/security/>Report a Vulnerability</a></small></li></ul></div></div></footer></div><script src=/kanto/js/main.min.71ce084bcf13abbf1fcd942047313f25a70594ce26ec4a6a93ab9a359a8cbf66.js integrity="sha256-cc4IS88Tq78fzZQgRzE/JacFlM4m7Epqk6uaNZqMv2Y=" crossorigin=anonymous></script><script src=/kanto/js/prism.js></script><script src=/kanto/js/tabpane-persist.js></script><script src=//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js></script></body></html>